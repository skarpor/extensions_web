# Data Query System 2.0 - 使用说明

## 系统概述

Data Query System 2.0 是一个现代化的数据查询和扩展管理平台，提供了强大的扩展机制，允许用户通过编写 Python 脚本来扩展系统功能。系统采用前后端分离架构，后端基于 FastAPI，前端使用 Vue3 + Vuetify。

## 快速开始

### 1. 系统要求

**服务器端要求:**
- Python 3.9 或更高版本
- 至少 2GB RAM
- 至少 5GB 可用磁盘空间

**客户端要求:**
- 现代浏览器 (Chrome 90+, Firefox 88+, Safari 14+, Edge 90+)
- 支持 JavaScript 和 WebSocket

### 2. 安装部署

#### 方式一：源码部署

1. **下载源码**
```bash
git clone <repository-url>
cd extensions_web
```

2. **安装后端依赖**
```bash
pip install -r requirements.txt
```

3. **安装前端依赖**
```bash
cd fr
npm install
```

4. **启动服务**
```bash
# 启动后端 (在项目根目录)
python main.py

# 启动前端 (在fr目录)
npm run dev
```

5. **访问系统**
- 前端界面: http://localhost:5173
- 后端API: http://localhost:8000
- API文档: http://localhost:8000/docs

#### 方式二：Docker部署

```bash
# 构建镜像
docker build -t data-query-system .

# 运行容器
docker run -d -p 8000:8000 -v ./data:/app/data data-query-system
```

### 3. 初始配置

首次启动系统后，会自动创建默认管理员账户：
- 用户名: `admin`
- 密码: `admin123`

**重要**: 请立即登录并修改默认密码！

## 核心功能使用

### 1. 用户管理

#### 登录系统
1. 访问系统首页
2. 点击"登录"按钮
3. 输入用户名和密码
4. 点击"登录"完成认证

#### 用户注册
1. 在登录页面点击"注册"
2. 填写用户信息
3. 提交注册申请
4. 等待管理员审核（如果启用了审核机制）

#### 个人资料管理
1. 登录后点击右上角用户头像
2. 选择"个人资料"
3. 修改个人信息
4. 保存更改

### 2. 扩展管理

#### 查看扩展列表
1. 导航到"扩展管理"页面
2. 查看所有已安装的扩展
3. 可以按状态、类型等筛选扩展

#### 安装新扩展
1. 在扩展管理页面点击"添加扩展"
2. 上传扩展脚本文件（.py格式）
3. 填写扩展名称和描述
4. 点击"创建"完成安装

#### 配置扩展
1. 在扩展列表中找到要配置的扩展
2. 点击"配置"按钮
3. 填写扩展所需的配置参数
4. 保存配置

#### 启用/禁用扩展
1. 在扩展列表中找到目标扩展
2. 点击状态开关
3. 确认操作

#### 使用扩展
1. 导航到"扩展查询"页面
2. 选择要使用的扩展
3. 填写查询参数
4. 点击"执行查询"
5. 查看结果

### 3. 文件管理

#### 上传文件
1. 导航到"文件管理"页面
2. 点击"上传文件"按钮
3. 选择要上传的文件
4. 选择存储目录
5. 点击"上传"

#### 文件操作
- **下载**: 点击文件名或下载按钮
- **预览**: 点击预览按钮（支持图片、文本等）
- **删除**: 点击删除按钮并确认
- **移动**: 拖拽文件到目标目录

#### 目录管理
- **创建目录**: 点击"新建文件夹"按钮
- **重命名**: 右键点击目录选择重命名
- **删除**: 右键点击目录选择删除

### 4. 数据库管理

#### 连接数据库
1. 导航到"数据库管理"页面
2. 配置数据库连接参数
3. 测试连接
4. 保存配置

#### 执行SQL查询
1. 在SQL编辑器中输入查询语句
2. 点击"执行"按钮
3. 查看查询结果
4. 可以导出结果为CSV或Excel

#### 表结构查看
1. 在左侧数据库树中选择表
2. 查看表结构、索引等信息
3. 可以查看表数据样本

### 5. 实时聊天

#### 创建聊天
1. 导航到"聊天"页面
2. 点击"新建聊天"
3. 输入聊天标题
4. 开始聊天

#### 发送消息
1. 在聊天输入框中输入消息
2. 可以上传图片或文件
3. 按Enter发送或点击发送按钮

#### 聊天管理
- **查看历史**: 滚动查看历史消息
- **搜索消息**: 使用搜索功能查找特定消息
- **删除聊天**: 右键点击聊天选择删除

### 6. 任务调度

#### 创建定时任务
1. 导航到"任务调度"页面
2. 点击"新建任务"
3. 配置任务参数：
   - 任务名称
   - 执行函数
   - 触发器类型（定时、间隔等）
   - 执行时间
4. 保存任务

#### 管理任务
- **启动/暂停**: 点击对应按钮
- **查看日志**: 点击日志按钮查看执行记录
- **修改任务**: 点击编辑按钮
- **删除任务**: 点击删除按钮

## 扩展开发

### 1. 扩展结构

每个扩展都是一个Python脚本，必须包含以下函数：

```python
def execute_query(params, config=None):
    """执行查询的主函数"""
    pass

def get_default_config():
    """返回默认配置"""
    return {}

def get_config_form():
    """返回配置表单HTML"""
    return ""

def get_query_form():
    """返回查询表单HTML"""
    return ""
```

### 2. 开发流程

1. **编写扩展脚本**
   - 实现必需的函数
   - 添加错误处理
   - 编写文档字符串

2. **本地测试**
   - 创建测试脚本
   - 验证功能正确性
   - 测试边界情况

3. **上传安装**
   - 通过系统界面上传脚本
   - 配置扩展参数
   - 启用扩展

4. **测试验证**
   - 使用查询表单测试
   - 检查结果正确性
   - 验证错误处理

### 3. 最佳实践

- **安全性**: 验证所有输入参数
- **性能**: 避免长时间阻塞操作
- **错误处理**: 提供友好的错误信息
- **文档**: 编写清晰的使用说明
- **兼容性**: 考虑不同环境的兼容性

## 系统配置

### 1. 基础配置

主要配置文件为 `config.py`，包含以下设置：

```python
# 服务器配置
HOST = "0.0.0.0"
PORT = 8000

# 数据库配置
SQLALCHEMY_DATABASE_URI = "sqlite+aiosqlite:///database.sqlite"

# 文件存储配置
FILE_UPLOAD_DIR = "data/file"
MAX_UPLOAD_SIZE = 52428800  # 50MB

# 扩展配置
EXTENSIONS_DIR = "data/extensions"
```

### 2. 环境变量

可以通过环境变量覆盖配置：

```bash
export DATABASE_URL="postgresql://user:pass@localhost/db"
export SECRET_KEY="your-secret-key"
export ALLOW_REGISTER="false"
```

### 3. 数据库配置

系统支持多种数据库：

- **SQLite**: 默认，适合小型部署
- **PostgreSQL**: 推荐用于生产环境
- **MySQL**: 广泛支持
- **SQL Server**: 企业环境

### 4. 安全配置

- **JWT密钥**: 设置强密码作为JWT签名密钥
- **CORS**: 配置允许的跨域来源
- **文件上传**: 限制文件类型和大小
- **扩展沙箱**: 启用扩展执行限制

## 故障排除

### 1. 常见问题

#### 无法启动服务
- 检查端口是否被占用
- 验证Python版本和依赖
- 查看错误日志

#### 数据库连接失败
- 检查数据库配置
- 验证数据库服务状态
- 检查网络连接

#### 扩展加载失败
- 检查扩展脚本语法
- 验证必需函数是否存在
- 查看扩展日志

#### 文件上传失败
- 检查文件大小限制
- 验证文件类型
- 检查存储空间

### 2. 日志查看

系统日志位于 `data/logs/` 目录：

- `app.log`: 主应用日志
- `extension.log`: 扩展相关日志
- `auth.log`: 认证相关日志
- `db_manager.log`: 数据库操作日志

### 3. 性能优化

#### 数据库优化
- 定期清理日志表
- 添加适当的索引
- 使用连接池

#### 文件存储优化
- 定期清理临时文件
- 使用CDN加速静态资源
- 压缩大文件

#### 扩展优化
- 使用异步操作
- 避免内存泄漏
- 合理设置超时时间

## 安全注意事项

### 1. 用户安全

- 使用强密码策略
- 启用双因素认证（如果支持）
- 定期更新密码
- 限制登录尝试次数

### 2. 数据安全

- 定期备份数据库
- 加密敏感数据
- 使用HTTPS传输
- 限制数据库访问权限

### 3. 扩展安全

- 审查扩展代码
- 限制扩展权限
- 监控扩展执行
- 定期更新扩展

### 4. 网络安全

- 配置防火墙规则
- 使用反向代理
- 启用访问日志
- 监控异常访问

## 维护指南

### 1. 日常维护

- 检查系统日志
- 监控资源使用
- 清理临时文件
- 更新系统组件

### 2. 数据备份

```bash
# 备份数据库
cp database.sqlite backup/database_$(date +%Y%m%d).sqlite

# 备份文件
tar -czf backup/files_$(date +%Y%m%d).tar.gz data/file/

# 备份扩展
tar -czf backup/extensions_$(date +%Y%m%d).tar.gz data/extensions/
```

### 3. 系统更新

1. 备份当前系统
2. 下载新版本
3. 更新依赖包
4. 运行数据库迁移
5. 测试系统功能
6. 部署到生产环境

### 4. 监控告警

- 设置资源使用告警
- 监控错误日志
- 检查服务可用性
- 监控数据库性能

## 技术支持

### 1. 文档资源

- [项目文档](./项目文档.md)
- [API接口文档](./API接口文档.md)
- [扩展开发指南](./扩展开发指南.md)
- [扩展脚本示例](./扩展脚本示例.md)

### 2. 社区支持

- GitHub Issues: 报告问题和建议
- 讨论区: 技术交流和经验分享
- Wiki: 社区维护的文档

### 3. 商业支持

如需专业技术支持，请联系：
- 邮箱: support@example.com
- 电话: +86-xxx-xxxx-xxxx
- 在线客服: 工作日 9:00-18:00

---

*使用说明最后更新: 2025-07-09*
