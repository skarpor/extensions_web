# Data Query System 2.0 - æ‰©å±•å¼€å‘æŒ‡å—

## æ‰©å±•ç³»ç»Ÿæ¦‚è¿°

Data Query System 2.0 çš„æ‰©å±•ç³»ç»Ÿæ˜¯ä¸€ä¸ªå¼ºå¤§è€Œçµæ´»çš„æ’ä»¶æ¶æ„ï¼Œå…è®¸å¼€å‘è€…é€šè¿‡ç¼–å†™ Python è„šæœ¬æ¥æ‰©å±•ç³»ç»ŸåŠŸèƒ½ã€‚æ‰©å±•ç³»ç»Ÿæä¾›äº†å®‰å…¨çš„æ²™ç®±ç¯å¢ƒã€ä¸°å¯Œçš„APIæ¥å£å’Œå®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸ”’ **å®‰å…¨æ²™ç®±**: æ‰©å±•åœ¨å—é™ç¯å¢ƒä¸­æ‰§è¡Œï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨
- ğŸ”Œ **çƒ­æ’æ‹”**: æ”¯æŒåŠ¨æ€åŠ è½½å’Œå¸è½½æ‰©å±•ï¼Œæ— éœ€é‡å¯ç³»ç»Ÿ
- ğŸ¨ **è‡ªå®šä¹‰ç•Œé¢**: æ”¯æŒHTMLè¡¨å•è‡ªå®šä¹‰é…ç½®å’ŒæŸ¥è¯¢ç•Œé¢
- ğŸ“Š **æ•°æ®è®¿é—®**: æä¾›å®‰å…¨çš„æ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿè®¿é—®æ¥å£
- ğŸ”„ **å¼‚æ­¥æ”¯æŒ**: å®Œå…¨æ”¯æŒå¼‚æ­¥æ“ä½œå’Œå¹¶å‘æ‰§è¡Œ
- ğŸ“ **è‡ªåŠ¨æ–‡æ¡£**: è‡ªåŠ¨ç”Ÿæˆæ‰©å±•æ–‡æ¡£å’ŒAPIæ¥å£

## æ‰©å±•åŸºç¡€ç»“æ„

### å¿…éœ€æ–¹æ³•

æ¯ä¸ªæ‰©å±•è„šæœ¬å¿…é¡»å®ç°ä»¥ä¸‹æ ¸å¿ƒæ–¹æ³•ï¼š

```python
def execute_query(params, config=None):
    """
    æ‰§è¡ŒæŸ¥è¯¢çš„æ ¸å¿ƒæ–¹æ³•
    
    Args:
        params (dict): æŸ¥è¯¢å‚æ•°ï¼Œæ¥è‡ªæŸ¥è¯¢è¡¨å•
        config (dict): æ‰©å±•é…ç½®ï¼Œæ¥è‡ªé…ç½®è¡¨å•
        
    Returns:
        dict: æŸ¥è¯¢ç»“æœ
    """
    pass
```

### å¯é€‰æ–¹æ³•

```python
def get_default_config():
    """
    è¿”å›æ‰©å±•çš„é»˜è®¤é…ç½®
    
    Returns:
        dict: é»˜è®¤é…ç½®å­—å…¸
    """
    return {}

def get_config_form():
    """
    è¿”å›é…ç½®è¡¨å•çš„HTML
    
    Returns:
        str: HTMLè¡¨å•å­—ç¬¦ä¸²
    """
    return "<p>æ­¤æ‰©å±•æ²¡æœ‰é…ç½®é€‰é¡¹</p>"

def get_query_form():
    """
    è¿”å›æŸ¥è¯¢è¡¨å•çš„HTML
    
    Returns:
        str: HTMLè¡¨å•å­—ç¬¦ä¸²
    """
    return "<p>æ­¤æ‰©å±•ä¸éœ€è¦æŸ¥è¯¢å‚æ•°</p>"

def validate_config(config):
    """
    éªŒè¯é…ç½®æœ‰æ•ˆæ€§
    
    Args:
        config (dict): è¦éªŒè¯çš„é…ç½®
        
    Returns:
        tuple: (æ˜¯å¦æœ‰æ•ˆ, é”™è¯¯ä¿¡æ¯)
    """
    return True, ""
```

## æ‰©å±•å¼€å‘æ¨¡æ¿

### åŸºç¡€æ¨¡æ¿

```python
"""
æ‰©å±•åç§°: æˆ‘çš„ç¬¬ä¸€ä¸ªæ‰©å±•
æ‰©å±•æè¿°: è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æ‰©å±•ï¼Œå±•ç¤ºåŸºæœ¬åŠŸèƒ½
ä½œè€…: å¼€å‘è€…å§“å
ç‰ˆæœ¬: 1.0.0
"""

def get_default_config():
    """è¿”å›é»˜è®¤é…ç½®"""
    return {
        "api_url": "https://api.example.com",
        "timeout": 30,
        "max_results": 100
    }

def get_config_form():
    """è¿”å›é…ç½®è¡¨å•HTML"""
    return """
    <div class="mb-3">
        <label for="config.api_url" class="form-label">APIåœ°å€</label>
        <input type="url" class="form-control" id="config.api_url" 
               name="config.api_url" value="{{ config.api_url }}" required>
        <div class="form-text">è¯·è¾“å…¥APIçš„å®Œæ•´URLåœ°å€</div>
    </div>
    
    <div class="mb-3">
        <label for="config.timeout" class="form-label">è¶…æ—¶æ—¶é—´(ç§’)</label>
        <input type="number" class="form-control" id="config.timeout" 
               name="config.timeout" value="{{ config.timeout }}" 
               min="1" max="300">
    </div>
    
    <div class="mb-3">
        <label for="config.max_results" class="form-label">æœ€å¤§ç»“æœæ•°</label>
        <input type="number" class="form-control" id="config.max_results" 
               name="config.max_results" value="{{ config.max_results }}" 
               min="1" max="1000">
    </div>
    """

def get_query_form():
    """è¿”å›æŸ¥è¯¢è¡¨å•HTML"""
    return """
    <div class="mb-3">
        <label for="keyword" class="form-label">æœç´¢å…³é”®è¯</label>
        <input type="text" class="form-control" id="keyword" name="keyword" 
               placeholder="è¾“å…¥æœç´¢å…³é”®è¯" required>
    </div>
    
    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="category" class="form-label">åˆ†ç±»</label>
            <select class="form-select" id="category" name="category">
                <option value="">å…¨éƒ¨åˆ†ç±»</option>
                <option value="news">æ–°é—»</option>
                <option value="blog">åšå®¢</option>
                <option value="forum">è®ºå›</option>
            </select>
        </div>
        <div class="col-md-6 mb-3">
            <label for="sort_by" class="form-label">æ’åºæ–¹å¼</label>
            <select class="form-select" id="sort_by" name="sort_by">
                <option value="relevance">ç›¸å…³æ€§</option>
                <option value="date">æ—¥æœŸ</option>
                <option value="popularity">çƒ­åº¦</option>
            </select>
        </div>
    </div>
    
    <div class="mb-3">
        <label for="data_file" class="form-label">æ•°æ®æ–‡ä»¶</label>
        <input type="file" class="form-control" id="data_file" name="data_file" 
               accept=".csv,.xlsx,.json">
        <div class="form-text">å¯é€‰ï¼šä¸Šä¼ æ•°æ®æ–‡ä»¶è¿›è¡Œå¤„ç†</div>
    </div>
    """

def validate_config(config):
    """éªŒè¯é…ç½®"""
    if not config.get("api_url"):
        return False, "APIåœ°å€ä¸èƒ½ä¸ºç©º"
    
    if not config.get("api_url").startswith(("http://", "https://")):
        return False, "APIåœ°å€å¿…é¡»æ˜¯æœ‰æ•ˆçš„URL"
    
    timeout = config.get("timeout", 30)
    if not isinstance(timeout, int) or timeout < 1 or timeout > 300:
        return False, "è¶…æ—¶æ—¶é—´å¿…é¡»åœ¨1-300ç§’ä¹‹é—´"
    
    return True, ""

def execute_query(params, config=None):
    """æ‰§è¡ŒæŸ¥è¯¢"""
    try:
        # è·å–æŸ¥è¯¢å‚æ•°
        keyword = params.get("keyword", "")
        category = params.get("category", "")
        sort_by = params.get("sort_by", "relevance")
        
        # è·å–é…ç½®
        api_url = config.get("api_url", "")
        timeout = config.get("timeout", 30)
        max_results = config.get("max_results", 100)
        
        # å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶
        files = params.get("files", {})
        if "data_file" in files:
            file_info = files["data_file"]
            # å¤„ç†æ–‡ä»¶å†…å®¹
            # file_content = file_info["content"]
            # filename = file_info["filename"]
        
        # æ¨¡æ‹ŸAPIè°ƒç”¨
        results = []
        for i in range(min(5, max_results)):
            results.append({
                "id": i + 1,
                "title": f"æœç´¢ç»“æœ {i + 1}: {keyword}",
                "category": category or "general",
                "url": f"https://example.com/result/{i + 1}",
                "snippet": f"è¿™æ˜¯å…³äº {keyword} çš„æœç´¢ç»“æœæ‘˜è¦...",
                "date": "2023-01-01",
                "score": 0.95 - i * 0.1
            })
        
        # è¿”å›ç»“æ„åŒ–ç»“æœ
        return {
            "success": True,
            "query_info": {
                "keyword": keyword,
                "category": category,
                "sort_by": sort_by,
                "total_found": len(results)
            },
            "config_used": {
                "api_url": api_url,
                "timeout": timeout,
                "max_results": max_results
            },
            "data": results,
            "meta": {
                "total": len(results),
                "page": 1,
                "page_size": max_results,
                "execution_time": 0.123
            }
        }
        
    except Exception as e:
        return {
            "success": False,
            "error": str(e),
            "data": []
        }
```

## é«˜çº§åŠŸèƒ½

### æ•°æ®åº“è®¿é—®

æ‰©å±•å¯ä»¥é€šè¿‡æ³¨å…¥çš„æ•°æ®åº“ç®¡ç†å™¨è®¿é—®æ•°æ®åº“ï¼š

```python
def execute_query(params, config=None, db_manager=None):
    """ä½¿ç”¨æ•°æ®åº“ç®¡ç†å™¨çš„æŸ¥è¯¢ç¤ºä¾‹"""
    if db_manager:
        # æ‰§è¡ŒSQLæŸ¥è¯¢
        sql = "SELECT * FROM users WHERE username LIKE ?"
        results = await db_manager.execute_query(sql, [f"%{params.get('keyword')}%"])
        
        return {
            "data": results,
            "sql_executed": sql
        }
    
    return {"error": "æ•°æ®åº“ç®¡ç†å™¨ä¸å¯ç”¨"}
```

### æ–‡ä»¶æ“ä½œ

æ‰©å±•å¯ä»¥å®‰å…¨åœ°å¤„ç†æ–‡ä»¶ä¸Šä¼ å’Œä¿å­˜ï¼š

```python
def execute_query(params, config=None):
    """æ–‡ä»¶å¤„ç†ç¤ºä¾‹"""
    files = params.get("files", {})
    file_manager = params.get("file_manager")
    
    processed_files = []
    
    for file_key, file_info in files.items():
        filename = file_info["filename"]
        content = file_info["content"]
        
        # å¤„ç†æ–‡ä»¶å†…å®¹
        if filename.endswith('.csv'):
            # å¤„ç†CSVæ–‡ä»¶
            import csv
            import io
            
            csv_data = io.StringIO(content.decode('utf-8'))
            reader = csv.DictReader(csv_data)
            data = list(reader)
            
            processed_files.append({
                "filename": filename,
                "type": "csv",
                "rows": len(data),
                "columns": list(data[0].keys()) if data else []
            })
        
        # ä¿å­˜å¤„ç†åçš„æ–‡ä»¶
        if file_manager:
            result_filename = f"processed_{filename}"
            file_manager.save_file(
                filename=result_filename,
                file_content=content
            )
    
    return {
        "processed_files": processed_files,
        "message": f"æˆåŠŸå¤„ç† {len(processed_files)} ä¸ªæ–‡ä»¶"
    }
```

### å¼‚æ­¥æ“ä½œ

æ‰©å±•æ”¯æŒå¼‚æ­¥æ“ä½œï¼Œé€‚åˆå¤„ç†è€—æ—¶ä»»åŠ¡ï¼š

```python
import asyncio
import aiohttp

async def execute_query(params, config=None):
    """å¼‚æ­¥æŸ¥è¯¢ç¤ºä¾‹"""
    urls = params.get("urls", [])
    timeout = config.get("timeout", 30)
    
    async def fetch_url(session, url):
        try:
            async with session.get(url, timeout=timeout) as response:
                return {
                    "url": url,
                    "status": response.status,
                    "content_length": len(await response.text())
                }
        except Exception as e:
            return {
                "url": url,
                "error": str(e)
            }
    
    async with aiohttp.ClientSession() as session:
        tasks = [fetch_url(session, url) for url in urls]
        results = await asyncio.gather(*tasks)
    
    return {
        "results": results,
        "total_urls": len(urls)
    }
```

### å¤–éƒ¨åº“ä½¿ç”¨

æ‰©å±•å¯ä»¥ä½¿ç”¨å¤–éƒ¨Pythonåº“ï¼Œä½†éœ€è¦é€šè¿‡å®‰å…¨æœºåˆ¶ï¼š

```python
def ensure_package(package_name):
    """å®‰å…¨åœ°å¯¼å…¥å¤–éƒ¨åŒ…"""
    try:
        return __import__(package_name)
    except ImportError:
        return None

def execute_query(params, config=None):
    """ä½¿ç”¨å¤–éƒ¨åº“çš„ç¤ºä¾‹"""
    # å°è¯•å¯¼å…¥pandas
    pandas = ensure_package('pandas')
    if pandas:
        # ä½¿ç”¨pandaså¤„ç†æ•°æ®
        data = params.get("data", [])
        df = pandas.DataFrame(data)
        
        return {
            "summary": {
                "rows": len(df),
                "columns": len(df.columns),
                "dtypes": df.dtypes.to_dict()
            },
            "head": df.head().to_dict('records')
        }
    else:
        return {"error": "pandasåº“ä¸å¯ç”¨"}
```

## è¡¨å•è®¾è®¡æŒ‡å—

### HTMLè¡¨å•è§„èŒƒ

1. **ä½¿ç”¨Bootstrapæ ·å¼**: æ‰€æœ‰è¡¨å•å…ƒç´ åº”ä½¿ç”¨Bootstrap CSSç±»
2. **å­—æ®µå‘½å**: é…ç½®å­—æ®µä½¿ç”¨ `config.field_name` æ ¼å¼
3. **éªŒè¯å±æ€§**: ä½¿ç”¨HTML5éªŒè¯å±æ€§å¦‚ `required`, `min`, `max`
4. **å¸®åŠ©æ–‡æœ¬**: ä½¿ç”¨ `form-text` ç±»æä¾›å­—æ®µè¯´æ˜

### å¸¸ç”¨è¡¨å•å…ƒç´ 

```html
<!-- æ–‡æœ¬è¾“å…¥ -->
<div class="mb-3">
    <label for="config.api_key" class="form-label">APIå¯†é’¥</label>
    <input type="password" class="form-control" id="config.api_key" 
           name="config.api_key" value="{{ config.api_key }}" required>
    <div class="form-text">è¯·è¾“å…¥æ‚¨çš„APIå¯†é’¥</div>
</div>

<!-- æ•°å­—è¾“å…¥ -->
<div class="mb-3">
    <label for="config.timeout" class="form-label">è¶…æ—¶æ—¶é—´</label>
    <input type="number" class="form-control" id="config.timeout" 
           name="config.timeout" value="{{ config.timeout }}" 
           min="1" max="300">
</div>

<!-- é€‰æ‹©æ¡† -->
<div class="mb-3">
    <label for="config.mode" class="form-label">è¿è¡Œæ¨¡å¼</label>
    <select class="form-select" id="config.mode" name="config.mode">
        <option value="auto" {{ 'selected' if config.mode == 'auto' else '' }}>è‡ªåŠ¨</option>
        <option value="manual" {{ 'selected' if config.mode == 'manual' else '' }}>æ‰‹åŠ¨</option>
    </select>
</div>

<!-- å¤é€‰æ¡† -->
<div class="mb-3 form-check">
    <input type="checkbox" class="form-check-input" id="config.enabled" 
           name="config.enabled" {{ 'checked' if config.enabled else '' }}>
    <label class="form-check-label" for="config.enabled">å¯ç”¨åŠŸèƒ½</label>
</div>

<!-- æ–‡ä»¶ä¸Šä¼  -->
<div class="mb-3">
    <label for="data_file" class="form-label">æ•°æ®æ–‡ä»¶</label>
    <input type="file" class="form-control" id="data_file" name="data_file" 
           accept=".csv,.xlsx,.json">
</div>

<!-- æ–‡æœ¬åŒºåŸŸ -->
<div class="mb-3">
    <label for="config.description" class="form-label">æè¿°</label>
    <textarea class="form-control" id="config.description" 
              name="config.description" rows="3">{{ config.description }}</textarea>
</div>
```

## å®‰å…¨è€ƒè™‘

### æ²™ç®±é™åˆ¶

æ‰©å±•åœ¨æ²™ç®±ç¯å¢ƒä¸­è¿è¡Œï¼Œæœ‰ä»¥ä¸‹é™åˆ¶ï¼š

1. **æ–‡ä»¶ç³»ç»Ÿè®¿é—®**: åªèƒ½é€šè¿‡æä¾›çš„APIè®¿é—®æ–‡ä»¶
2. **ç½‘ç»œè®¿é—®**: å¯ä»¥è¿›è¡ŒHTTPè¯·æ±‚ï¼Œä½†æœ‰è¶…æ—¶é™åˆ¶
3. **ç³»ç»Ÿè°ƒç”¨**: ç¦æ­¢ç›´æ¥ç³»ç»Ÿè°ƒç”¨å’Œè¿›ç¨‹æ“ä½œ
4. **å†…å­˜é™åˆ¶**: æœ‰å†…å­˜ä½¿ç”¨é™åˆ¶ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
5. **æ‰§è¡Œæ—¶é—´**: æœ‰æœ€å¤§æ‰§è¡Œæ—¶é—´é™åˆ¶

### æœ€ä½³å®è·µ

1. **è¾“å…¥éªŒè¯**: å§‹ç»ˆéªŒè¯ç”¨æˆ·è¾“å…¥
2. **é”™è¯¯å¤„ç†**: ä½¿ç”¨try-catchå¤„ç†å¼‚å¸¸
3. **èµ„æºæ¸…ç†**: åŠæ—¶é‡Šæ”¾èµ„æº
4. **æ•æ„Ÿä¿¡æ¯**: ä¸è¦åœ¨è¿”å›ç»“æœä¸­åŒ…å«æ•æ„Ÿä¿¡æ¯
5. **æ—¥å¿—è®°å½•**: é€‚å½“è®°å½•æ“ä½œæ—¥å¿—

```python
def execute_query(params, config=None):
    """å®‰å…¨çš„æŸ¥è¯¢å®ç°"""
    try:
        # è¾“å…¥éªŒè¯
        keyword = params.get("keyword", "").strip()
        if not keyword:
            return {"error": "æœç´¢å…³é”®è¯ä¸èƒ½ä¸ºç©º"}
        
        if len(keyword) > 100:
            return {"error": "æœç´¢å…³é”®è¯è¿‡é•¿"}
        
        # é…ç½®éªŒè¯
        api_key = config.get("api_key", "")
        if not api_key:
            return {"error": "APIå¯†é’¥æœªé…ç½®"}
        
        # æ‰§è¡ŒæŸ¥è¯¢
        results = perform_search(keyword, api_key)
        
        # æ¸…ç†æ•æ„Ÿä¿¡æ¯
        safe_results = []
        for result in results:
            safe_results.append({
                "title": result.get("title", ""),
                "url": result.get("url", ""),
                "snippet": result.get("snippet", "")
                # ä¸åŒ…å«APIå¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯
            })
        
        return {
            "success": True,
            "data": safe_results,
            "total": len(safe_results)
        }
        
    except Exception as e:
        # è®°å½•é”™è¯¯ä½†ä¸æš´éœ²è¯¦ç»†ä¿¡æ¯
        return {
            "success": False,
            "error": "æŸ¥è¯¢æ‰§è¡Œå¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®å’Œå‚æ•°"
        }
```

## è°ƒè¯•å’Œæµ‹è¯•

### æœ¬åœ°æµ‹è¯•

åœ¨å¼€å‘æ‰©å±•æ—¶ï¼Œå¯ä»¥åˆ›å»ºç®€å•çš„æµ‹è¯•è„šæœ¬ï¼š

```python
# test_extension.py
import sys
sys.path.append('.')

# å¯¼å…¥ä½ çš„æ‰©å±•
import my_extension

# æµ‹è¯•é…ç½®
test_config = {
    "api_url": "https://api.example.com",
    "timeout": 30
}

# æµ‹è¯•å‚æ•°
test_params = {
    "keyword": "test",
    "category": "news"
}

# æ‰§è¡Œæµ‹è¯•
result = my_extension.execute_query(test_params, test_config)
print("æµ‹è¯•ç»“æœ:", result)

# æµ‹è¯•é…ç½®éªŒè¯
is_valid, error = my_extension.validate_config(test_config)
print("é…ç½®éªŒè¯:", is_valid, error)
```

### æ—¥å¿—è®°å½•

åœ¨æ‰©å±•ä¸­ä½¿ç”¨æ—¥å¿—è®°å½•è°ƒè¯•ä¿¡æ¯ï¼š

```python
import logging

# åˆ›å»ºæ—¥å¿—è®°å½•å™¨
logger = logging.getLogger(__name__)

def execute_query(params, config=None):
    """å¸¦æ—¥å¿—è®°å½•çš„æŸ¥è¯¢"""
    logger.info(f"å¼€å§‹æ‰§è¡ŒæŸ¥è¯¢ï¼Œå‚æ•°: {params}")
    
    try:
        # æŸ¥è¯¢é€»è¾‘
        result = perform_query(params, config)
        logger.info(f"æŸ¥è¯¢æˆåŠŸï¼Œè¿”å› {len(result.get('data', []))} æ¡ç»“æœ")
        return result
        
    except Exception as e:
        logger.error(f"æŸ¥è¯¢å¤±è´¥: {str(e)}")
        raise
```

## æ‰©å±•ç¤ºä¾‹

### 1. ç®€å•APIæŸ¥è¯¢æ‰©å±•

```python
"""
å¤©æ°”æŸ¥è¯¢æ‰©å±•
"""
import requests

def get_default_config():
    return {
        "api_key": "",
        "base_url": "https://api.openweathermap.org/data/2.5"
    }

def get_config_form():
    return """
    <div class="mb-3">
        <label for="config.api_key" class="form-label">OpenWeather APIå¯†é’¥</label>
        <input type="password" class="form-control" id="config.api_key" 
               name="config.api_key" value="{{ config.api_key }}" required>
    </div>
    """

def get_query_form():
    return """
    <div class="mb-3">
        <label for="city" class="form-label">åŸå¸‚åç§°</label>
        <input type="text" class="form-control" id="city" name="city" 
               placeholder="è¾“å…¥åŸå¸‚åç§°" required>
    </div>
    """

def execute_query(params, config=None):
    city = params.get("city", "")
    api_key = config.get("api_key", "")
    base_url = config.get("base_url", "")
    
    url = f"{base_url}/weather"
    response = requests.get(url, params={
        "q": city,
        "appid": api_key,
        "units": "metric"
    })
    
    if response.status_code == 200:
        data = response.json()
        return {
            "city": data["name"],
            "temperature": data["main"]["temp"],
            "description": data["weather"][0]["description"],
            "humidity": data["main"]["humidity"]
        }
    else:
        return {"error": "æ— æ³•è·å–å¤©æ°”ä¿¡æ¯"}
```

### 2. æ•°æ®å¤„ç†æ‰©å±•

```python
"""
CSVæ•°æ®åˆ†ææ‰©å±•
"""
import csv
import io
from collections import Counter

def get_query_form():
    return """
    <div class="mb-3">
        <label for="csv_file" class="form-label">CSVæ–‡ä»¶</label>
        <input type="file" class="form-control" id="csv_file" name="csv_file" 
               accept=".csv" required>
    </div>
    
    <div class="mb-3">
        <label for="column" class="form-label">åˆ†æåˆ—å</label>
        <input type="text" class="form-control" id="column" name="column" 
               placeholder="è¾“å…¥è¦åˆ†æçš„åˆ—å">
    </div>
    """

def execute_query(params, config=None):
    files = params.get("files", {})
    column = params.get("column", "")
    
    if "csv_file" not in files:
        return {"error": "è¯·ä¸Šä¼ CSVæ–‡ä»¶"}
    
    file_content = files["csv_file"]["content"]
    csv_data = io.StringIO(file_content.decode('utf-8'))
    
    reader = csv.DictReader(csv_data)
    data = list(reader)
    
    if not data:
        return {"error": "CSVæ–‡ä»¶ä¸ºç©º"}
    
    # åŸºæœ¬ç»Ÿè®¡
    result = {
        "total_rows": len(data),
        "columns": list(data[0].keys()),
        "sample_data": data[:5]
    }
    
    # å¦‚æœæŒ‡å®šäº†åˆ—ï¼Œè¿›è¡Œè¯¦ç»†åˆ†æ
    if column and column in data[0]:
        values = [row[column] for row in data if row[column]]
        counter = Counter(values)
        
        result["column_analysis"] = {
            "column": column,
            "unique_values": len(counter),
            "most_common": counter.most_common(10),
            "total_non_empty": len(values)
        }
    
    return result
```

## éƒ¨ç½²å’Œåˆ†å‘

### æ‰©å±•æ‰“åŒ…

åˆ›å»ºæ‰©å±•åŒ…æ—¶ï¼Œå»ºè®®åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

```
my_extension/
â”œâ”€â”€ extension.py      # ä¸»æ‰©å±•æ–‡ä»¶
â”œâ”€â”€ README.md        # æ‰©å±•è¯´æ˜
â”œâ”€â”€ requirements.txt # ä¾èµ–åˆ—è¡¨
â””â”€â”€ examples/        # ä½¿ç”¨ç¤ºä¾‹
    â””â”€â”€ config.json
```

### å®‰è£…æŒ‡å—

ä¸ºç”¨æˆ·æä¾›æ¸…æ™°çš„å®‰è£…æŒ‡å—ï¼š

1. **ä¸Šä¼ æ‰©å±•æ–‡ä»¶**: é€šè¿‡ç³»ç»Ÿç•Œé¢ä¸Šä¼  `.py` æ–‡ä»¶
2. **é…ç½®æ‰©å±•**: å¡«å†™å¿…è¦çš„é…ç½®ä¿¡æ¯
3. **å¯ç”¨æ‰©å±•**: åœ¨æ‰©å±•ç®¡ç†é¡µé¢å¯ç”¨æ‰©å±•
4. **æµ‹è¯•åŠŸèƒ½**: ä½¿ç”¨æŸ¥è¯¢è¡¨å•æµ‹è¯•æ‰©å±•åŠŸèƒ½

### ç‰ˆæœ¬ç®¡ç†

å»ºè®®åœ¨æ‰©å±•æ–‡ä»¶ä¸­åŒ…å«ç‰ˆæœ¬ä¿¡æ¯ï¼š

```python
"""
æ‰©å±•åç§°: æˆ‘çš„æ‰©å±•
ç‰ˆæœ¬: 1.2.0
ä½œè€…: å¼€å‘è€…
æ›´æ–°æ—¥æœŸ: 2023-01-01
å…¼å®¹ç‰ˆæœ¬: Data Query System 2.0+

æ›´æ–°æ—¥å¿—:
v1.2.0 - æ–°å¢å¼‚æ­¥æ”¯æŒ
v1.1.0 - ä¼˜åŒ–é”™è¯¯å¤„ç†
v1.0.0 - åˆå§‹ç‰ˆæœ¬
"""

__version__ = "1.2.0"
__author__ = "å¼€å‘è€…"
__compatibility__ = "2.0+"
```

## å¸¸è§é—®é¢˜

### Q: æ‰©å±•æ— æ³•åŠ è½½æ€ä¹ˆåŠï¼Ÿ
A: æ£€æŸ¥æ‰©å±•è„šæœ¬è¯­æ³•ã€ç¡®ä¿å®ç°äº†å¿…éœ€çš„æ–¹æ³•ã€æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚

### Q: å¦‚ä½•å¤„ç†å¤§æ–‡ä»¶ä¸Šä¼ ï¼Ÿ
A: ç³»ç»Ÿæœ‰æ–‡ä»¶å¤§å°é™åˆ¶ï¼Œå¯¹äºå¤§æ–‡ä»¶å»ºè®®åˆ†å—å¤„ç†æˆ–ä½¿ç”¨æµå¼å¤„ç†ã€‚

### Q: æ‰©å±•å¯ä»¥è®¿é—®å“ªäº›ç³»ç»Ÿèµ„æºï¼Ÿ
A: æ‰©å±•å¯ä»¥é€šè¿‡æä¾›çš„APIè®¿é—®æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œï¼Œä½†ä¸èƒ½ç›´æ¥è®¿é—®ç³»ç»Ÿèµ„æºã€‚

### Q: å¦‚ä½•è°ƒè¯•æ‰©å±•ï¼Ÿ
A: ä½¿ç”¨æ—¥å¿—è®°å½•ã€åœ¨æœ¬åœ°ç¯å¢ƒæµ‹è¯•ã€æŸ¥çœ‹ç³»ç»Ÿé”™è¯¯æ—¥å¿—ã€ä½¿ç”¨APIæ–‡æ¡£æµ‹è¯•æ¥å£ã€‚

### Q: æ‰©å±•æ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼Ÿ
A: ä½¿ç”¨å¼‚æ­¥æ“ä½œã€é¿å…é˜»å¡è°ƒç”¨ã€åˆç†ä½¿ç”¨ç¼“å­˜ã€åŠæ—¶é‡Šæ”¾èµ„æºã€‚

---

*æ‰©å±•å¼€å‘æŒ‡å—æœ€åæ›´æ–°: 2025-07-09*
