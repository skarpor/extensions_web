# 配置参数与查询参数

在扩展数据查询系统中，参数分为两类：**配置参数**和**查询参数**。理解这两者的区别对于正确设计和使用扩展非常重要。

## 基本概念

### 配置参数 (Config)

配置参数是由**管理员**设置的**长期稳定**的参数，通常不会频繁更改。这些参数在扩展加载时被读取，并在所有查询中使用。

### 查询参数 (Params)

查询参数是由**用户**在**每次查询**时提供的输入，可能每次查询都不同。这些参数仅用于当前查询，不会被长期保存。

## 详细比较

| 特性 | 配置参数 (Config) | 查询参数 (Params) |
|-----|----------------|-----------------|
| **设置者** | 管理员 | 终端用户 |
| **变更频率** | 低，长期稳定 | 高，每次查询可能不同 |
| **存储方式** | 持久化存储在系统中 | 临时使用，不持久保存 |
| **设置界面** | 管理后台的扩展配置页面 | 用户查询界面 |
| **定义函数** | `get_default_config()` | 不适用 |
| **表单函数** | `get_config_form()` | `get_query_form()` |
| **表单元素前缀** | `config.参数名` | `query.参数名` |
| **访问方式** | `execute_query`函数的`config`参数 | `execute_query`函数的`params`参数 |

## 适用场景

### 适合作为配置参数的内容

1. **连接信息**
   - 数据库连接字符串
   - API基础URL
   - 服务器地址和端口

2. **认证信息**
   - API密钥
   - 用户名和密码
   - 认证令牌

3. **全局限制和默认值**
   - 每页显示记录数
   - 最大结果数
   - 查询超时时间
   - 默认排序方式

4. **功能开关**
   - 是否启用高级功能
   - 是否启用缓存
   - 是否允许导出数据

5. **系统行为控制**
   - 重试策略
   - 缓存有效期
   - 错误处理方式

### 适合作为查询参数的内容

1. **搜索条件**
   - 关键词
   - 日期范围
   - 数值范围

2. **筛选条件**
   - 类别
   - 状态
   - 标签

3. **排序控制**
   - 排序字段
   - 排序方向（升序/降序）

4. **分页控制**
   - 当前页码
   - 每页显示数量（可覆盖配置中的默认值）

5. **上传文件**
   - 需要处理或分析的文件
   - 导入的数据文件

6. **输出格式**
   - 结果格式（如JSON、CSV、HTML等）
   - 是否包含详细信息

## 设计建议

### 配置参数设计建议

1. **保持简洁**：只包含真正需要管理员配置的参数，避免过多选项导致管理复杂。

2. **提供合理默认值**：每个配置参数都应有合理的默认值，减少管理员的配置负担。

3. **分组组织**：将相关的配置选项分组，使界面更有条理性。例如：
   - 连接设置
   - 认证设置
   - 性能选项
   - 功能开关

4. **安全处理敏感信息**：
   - 密码和密钥使用`password`类型输入框
   - 不在日志中记录敏感信息
   - 考虑使用加密存储

5. **验证和提示**：
   - 提供字段说明和帮助文本
   - 实现适当的验证规则
   - 提供错误信息和建议

### 查询参数设计建议

1. **用户友好**：设计直观、易用的表单，考虑不同用户的技能水平。

2. **响应式设计**：适应不同屏幕大小，使用Bootstrap栅格系统。

3. **适当的控件类型**：
   - 日期选择器用于日期输入
   - 下拉列表用于有限选项
   - 多选框用于多值选择
   - 滑块用于范围选择

4. **动态表单**：根据用户的选择动态显示或隐藏相关字段。

5. **参数验证**：
   - 客户端验证提高用户体验
   - 服务器端验证确保安全
   - 清晰的错误消息帮助用户修正输入

6. **默认值**：为常用查询条件提供合理的默认值，减少用户输入负担。

## 实际示例

### 配置参数示例

数据库连接扩展的配置参数：

```json
{
  "db_host": "localhost",
  "db_port": 3306,
  "db_name": "mydatabase",
  "db_user": "dbuser",
  "db_password": "******",
  "connection_timeout": 30,
  "max_pool_size": 10,
  "default_page_size": 20,
  "enable_query_cache": true,
  "cache_ttl": 300
}
```

### 查询参数示例

同一扩展的查询参数：

```json
{
  "query": {
    "keyword": "产品",
    "start_date": "2025-01-01",
    "end_date": "2025-05-01",
    "category": "electronics",
    "min_price": 100,
    "max_price": 1000,
    "status": ["active", "pending"],
    "sort_by": "price",
    "sort_order": "desc",
    "page": 1,
    "page_size": 25
  }
}
```

## 最佳实践

1. **明确分离职责**：
   - 配置参数处理连接和全局设置
   - 查询参数处理特定查询的条件

2. **避免重复**：不要在查询参数中重复配置参数中已有的设置，除非允许用户覆盖默认设置。

3. **安全第一**：敏感信息只放在配置参数中，并确保适当的访问控制。

4. **文档化**：为每个参数提供清晰的文档，说明其用途、类型和可能的值。

5. **参数命名**：使用一致的命名约定，使参数的用途一目了然。
   - 配置参数：`db_host`, `api_key`, `default_sort`
   - 查询参数：`keyword`, `start_date`, `category`

---

遵循这些指导原则，您可以创建既灵活又易于使用的扩展，清晰地区分管理员配置和用户查询参数，提供更好的用户体验。 